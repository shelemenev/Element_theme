{"version":3,"sources":["webpack:///./matrix-react-sdk/src/async-components/views/dialogs/security/CreateSecretStorageDialog.tsx"],"names":["Phase","PASSWORD_MIN_SCORE","CreateSecretStorageDialog","React","PureComponent","constructor","props","createRef","state","phase","Migrate","fetchBackupInfo","e","setState","passPhraseKeySelected","target","value","SecureBackupSetupMethod","Key","recoveryKey","MatrixClientPeg","get","createRecoveryKeyFromPassphrase","copied","downloaded","setPassphrase","ShowKey","Passphrase","preventDefault","backupSigStatus","usable","bootstrapSecretStorage","restoreBackup","successful","copyNode","recoveryKeyNode","current","blob","Blob","encodedPrivateKey","type","FileSaver","saveAs","makeRequest","canUploadKeysWithPasswordOnly","accountPassword","identifier","user","getUserId","password","dialogAesthetics","SSOAuthEntry","PHASE_PREAUTH","title","_t","body","continueText","continueKind","PHASE_POSTAUTH","finished","Modal","createTrackedDialog","InteractiveAuthDialog","matrixClient","aestheticsForStagePhases","LOGIN_TYPE","UNSTABLE_LOGIN_TYPE","confirmed","Error","Storing","error","cli","forceReset","logger","log","createSecretStorageKey","setupNewKeyBackup","setupNewSecretStorage","bootstrapCrossSigning","authUploadDeviceSigningKeys","doBootstrapUIAuth","keyBackupInfo","backupInfo","getKeyBackupPassphrase","backupKey","promptForBackupPassphrase","onFinished","httpStatus","data","flows","accountPasswordCorrect","keyCallback","k","RestoreKeyBackupDialog","showSummary","Loading","ConfirmSkip","ChooseKeyPassphrase","passphraseField","validate","allowEmpty","valid","focus","focused","PassphraseConfirm","passPhrase","passPhraseConfirm","passPhraseValid","result","setupMethods","getSecureBackupSetupMethods","includes","queryKeyUploadAuth","canSkip","isSecureBackupRequired","on","CryptoEvent","KeyBackupStatus","onKeyBackupStatusChange","getInitialPhase","componentWillUnmount","removeListener","keyFromCustomisations","SecurityCustomisations","privateKey","getKeyBackupVersion","isCryptoEnabled","isKeyBackupTrusted","LoadError","uploadDeviceSigningKeys","some","f","stages","length","renderOptionKey","onKeyPassphraseChange","renderOptionPassphrase","renderPhaseChooseKeyPassphrase","optionKey","optionPassphrase","onChooseKeyPassphraseFormSubmit","onCancelClick","renderPhaseMigrate","authPrompt","nextCaption","onAccountPasswordChange","onMigrateFormSubmit","renderPhasePassPhrase","onPassPhraseNextClick","onPassPhraseChange","onPassPhraseValidate","_td","renderPhasePassPhraseConfirm","matchText","changeText","startsWith","passPhraseMatch","onSetAgainClick","onPassPhraseConfirmNextClick","onPassPhraseConfirmChange","renderPhaseShowKey","continueButton","onShowKeyContinueClick","onDownloadClick","onCopyClick","renderBusyPhase","renderPhaseLoadError","onLoadRetryClick","onCancel","renderPhaseSkipConfirm","onGoBackClick","titleForPhase","render","content","titleClass","hasCancel"],"mappings":"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","file":"bundles/44e8ec706535e1389ea6/32.js","sourcesContent":["/*\nCopyright 2018, 2019 New Vector Ltd\nCopyright 2019, 2020 The Matrix.org Foundation C.I.C.\n\nLicensed under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License.\nYou may obtain a copy of the License at\n\n    http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software\ndistributed under the License is distributed on an \"AS IS\" BASIS,\nWITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\nSee the License for the specific language governing permissions and\nlimitations under the License.\n*/\n\nimport React, { createRef } from 'react';\nimport FileSaver from 'file-saver';\nimport { logger } from \"matrix-js-sdk/src/logger\";\nimport { IKeyBackupInfo } from \"matrix-js-sdk/src/crypto/keybackup\";\nimport { TrustInfo } from \"matrix-js-sdk/src/crypto/backup\";\nimport { CrossSigningKeys } from \"matrix-js-sdk/src/matrix\";\nimport { IRecoveryKey } from \"matrix-js-sdk/src/crypto/api\";\nimport { CryptoEvent } from \"matrix-js-sdk/src/crypto\";\n\nimport { MatrixClientPeg } from '../../../../MatrixClientPeg';\nimport { _t, _td } from '../../../../languageHandler';\nimport Modal from '../../../../Modal';\nimport { promptForBackupPassphrase } from '../../../../SecurityManager';\nimport { copyNode } from \"../../../../utils/strings\";\nimport { SSOAuthEntry } from \"../../../../components/views/auth/InteractiveAuthEntryComponents\";\nimport PassphraseField from \"../../../../components/views/auth/PassphraseField\";\nimport StyledRadioButton from '../../../../components/views/elements/StyledRadioButton';\nimport AccessibleButton from \"../../../../components/views/elements/AccessibleButton\";\nimport DialogButtons from \"../../../../components/views/elements/DialogButtons\";\nimport InlineSpinner from \"../../../../components/views/elements/InlineSpinner\";\nimport RestoreKeyBackupDialog from \"../../../../components/views/dialogs/security/RestoreKeyBackupDialog\";\nimport {\n    getSecureBackupSetupMethods,\n    isSecureBackupRequired,\n    SecureBackupSetupMethod,\n} from '../../../../utils/WellKnownUtils';\nimport SecurityCustomisations from \"../../../../customisations/Security\";\nimport { IDialogProps } from \"../../../../components/views/dialogs/IDialogProps\";\nimport Field from \"../../../../components/views/elements/Field\";\nimport BaseDialog from \"../../../../components/views/dialogs/BaseDialog\";\nimport Spinner from \"../../../../components/views/elements/Spinner\";\nimport InteractiveAuthDialog from \"../../../../components/views/dialogs/InteractiveAuthDialog\";\nimport { IValidationResult } from \"../../../../components/views/elements/Validation\";\n\n// I made a mistake while converting this and it has to be fixed!\nenum Phase {\n    Loading = \"loading\",\n    LoadError = \"load_error\",\n    ChooseKeyPassphrase = \"choose_key_passphrase\",\n    Migrate = \"migrate\",\n    Passphrase = \"passphrase\",\n    PassphraseConfirm = \"passphrase_confirm\",\n    ShowKey = \"show_key\",\n    Storing = \"storing\",\n    ConfirmSkip = \"confirm_skip\",\n}\n\nconst PASSWORD_MIN_SCORE = 4; // So secure, many characters, much complex, wow, etc, etc.\n\ninterface IProps extends IDialogProps {\n    hasCancel: boolean;\n    accountPassword: string;\n    forceReset: boolean;\n}\n\ninterface IState {\n    phase: Phase;\n    passPhrase: string;\n    passPhraseValid: boolean;\n    passPhraseConfirm: string;\n    copied: boolean;\n    downloaded: boolean;\n    setPassphrase: boolean;\n    backupInfo: IKeyBackupInfo;\n    backupSigStatus: TrustInfo;\n    // does the server offer a UI auth flow with just m.login.password\n    // for /keys/device_signing/upload?\n    canUploadKeysWithPasswordOnly: boolean;\n    accountPassword: string;\n    accountPasswordCorrect: boolean;\n    canSkip: boolean;\n    passPhraseKeySelected: string;\n    error?: string;\n}\n\n/*\n * Walks the user through the process of creating a passphrase to guard Secure\n * Secret Storage in account data.\n */\nexport default class CreateSecretStorageDialog extends React.PureComponent<IProps, IState> {\n    public static defaultProps: Partial<IProps> = {\n        hasCancel: true,\n        forceReset: false,\n    };\n    private recoveryKey: IRecoveryKey;\n    private backupKey: Uint8Array;\n    private recoveryKeyNode = createRef<HTMLElement>();\n    private passphraseField = createRef<Field>();\n\n    constructor(props: IProps) {\n        super(props);\n\n        let passPhraseKeySelected;\n        const setupMethods = getSecureBackupSetupMethods();\n        if (setupMethods.includes(SecureBackupSetupMethod.Key)) {\n            passPhraseKeySelected = SecureBackupSetupMethod.Key;\n        } else {\n            passPhraseKeySelected = SecureBackupSetupMethod.Passphrase;\n        }\n\n        const accountPassword = props.accountPassword || \"\";\n        let canUploadKeysWithPasswordOnly = null;\n        if (accountPassword) {\n            // If we have an account password in memory, let's simplify and\n            // assume it means password auth is also supported for device\n            // signing key upload as well. This avoids hitting the server to\n            // test auth flows, which may be slow under high load.\n            canUploadKeysWithPasswordOnly = true;\n        } else {\n            this.queryKeyUploadAuth();\n        }\n\n        this.state = {\n            phase: Phase.Loading,\n            passPhrase: '',\n            passPhraseValid: false,\n            passPhraseConfirm: '',\n            copied: false,\n            downloaded: false,\n            setPassphrase: false,\n            backupInfo: null,\n            backupSigStatus: null,\n            // does the server offer a UI auth flow with just m.login.password\n            // for /keys/device_signing/upload?\n            accountPasswordCorrect: null,\n            canSkip: !isSecureBackupRequired(),\n            canUploadKeysWithPasswordOnly,\n            passPhraseKeySelected,\n            accountPassword,\n        };\n\n        MatrixClientPeg.get().on(CryptoEvent.KeyBackupStatus, this.onKeyBackupStatusChange);\n\n        this.getInitialPhase();\n    }\n\n    public componentWillUnmount(): void {\n        MatrixClientPeg.get().removeListener(CryptoEvent.KeyBackupStatus, this.onKeyBackupStatusChange);\n    }\n\n    private getInitialPhase(): void {\n        const keyFromCustomisations = SecurityCustomisations.createSecretStorageKey?.();\n        if (keyFromCustomisations) {\n            logger.log(\"Created key via customisations, jumping to bootstrap step\");\n            this.recoveryKey = {\n                privateKey: keyFromCustomisations,\n            };\n            this.bootstrapSecretStorage();\n            return;\n        }\n\n        this.fetchBackupInfo();\n    }\n\n    private async fetchBackupInfo(): Promise<{ backupInfo: IKeyBackupInfo, backupSigStatus: TrustInfo }> {\n        try {\n            const backupInfo = await MatrixClientPeg.get().getKeyBackupVersion();\n            const backupSigStatus = (\n                // we may not have started crypto yet, in which case we definitely don't trust the backup\n                MatrixClientPeg.get().isCryptoEnabled() && (await MatrixClientPeg.get().isKeyBackupTrusted(backupInfo))\n            );\n\n            const { forceReset } = this.props;\n            const phase = (backupInfo && !forceReset) ? Phase.Migrate : Phase.ChooseKeyPassphrase;\n\n            this.setState({\n                phase,\n                backupInfo,\n                backupSigStatus,\n            });\n\n            return {\n                backupInfo,\n                backupSigStatus,\n            };\n        } catch (e) {\n            this.setState({ phase: Phase.LoadError });\n        }\n    }\n\n    private async queryKeyUploadAuth(): Promise<void> {\n        try {\n            await MatrixClientPeg.get().uploadDeviceSigningKeys(null, {} as CrossSigningKeys);\n            // We should never get here: the server should always require\n            // UI auth to upload device signing keys. If we do, we upload\n            // no keys which would be a no-op.\n            logger.log(\"uploadDeviceSigningKeys unexpectedly succeeded without UI auth!\");\n        } catch (error) {\n            if (!error.data || !error.data.flows) {\n                logger.log(\"uploadDeviceSigningKeys advertised no flows!\");\n                return;\n            }\n            const canUploadKeysWithPasswordOnly = error.data.flows.some(f => {\n                return f.stages.length === 1 && f.stages[0] === 'm.login.password';\n            });\n            this.setState({\n                canUploadKeysWithPasswordOnly,\n            });\n        }\n    }\n\n    private onKeyBackupStatusChange = (): void => {\n        if (this.state.phase === Phase.Migrate) this.fetchBackupInfo();\n    };\n\n    private onKeyPassphraseChange = (e: React.ChangeEvent<HTMLInputElement>): void => {\n        this.setState({\n            passPhraseKeySelected: e.target.value,\n        });\n    };\n\n    private onChooseKeyPassphraseFormSubmit = async (): Promise<void> => {\n        if (this.state.passPhraseKeySelected === SecureBackupSetupMethod.Key) {\n            this.recoveryKey =\n                await MatrixClientPeg.get().createRecoveryKeyFromPassphrase();\n            this.setState({\n                copied: false,\n                downloaded: false,\n                setPassphrase: false,\n                phase: Phase.ShowKey,\n            });\n        } else {\n            this.setState({\n                copied: false,\n                downloaded: false,\n                phase: Phase.Passphrase,\n            });\n        }\n    };\n\n    private onMigrateFormSubmit = (e: React.FormEvent): void => {\n        e.preventDefault();\n        if (this.state.backupSigStatus.usable) {\n            this.bootstrapSecretStorage();\n        } else {\n            this.restoreBackup();\n        }\n    };\n\n    private onCopyClick = (): void => {\n        const successful = copyNode(this.recoveryKeyNode.current);\n        if (successful) {\n            this.setState({\n                copied: true,\n            });\n        }\n    };\n\n    private onDownloadClick = (): void => {\n        const blob = new Blob([this.recoveryKey.encodedPrivateKey], {\n            type: 'text/plain;charset=us-ascii',\n        });\n        FileSaver.saveAs(blob, 'security-key.txt');\n\n        this.setState({\n            downloaded: true,\n        });\n    };\n\n    private doBootstrapUIAuth = async (makeRequest: (authData: any) => void): Promise<void> => {\n        if (this.state.canUploadKeysWithPasswordOnly && this.state.accountPassword) {\n            await makeRequest({\n                type: 'm.login.password',\n                identifier: {\n                    type: 'm.id.user',\n                    user: MatrixClientPeg.get().getUserId(),\n                },\n                // TODO: Remove `user` once servers support proper UIA\n                // See https://github.com/matrix-org/synapse/issues/5665\n                user: MatrixClientPeg.get().getUserId(),\n                password: this.state.accountPassword,\n            });\n        } else {\n            const dialogAesthetics = {\n                [SSOAuthEntry.PHASE_PREAUTH]: {\n                    title: _t(\"Use Single Sign On to continue\"),\n                    body: _t(\"To continue, use Single Sign On to prove your identity.\"),\n                    continueText: _t(\"Single Sign On\"),\n                    continueKind: \"primary\",\n                },\n                [SSOAuthEntry.PHASE_POSTAUTH]: {\n                    title: _t(\"Confirm encryption setup\"),\n                    body: _t(\"Click the button below to confirm setting up encryption.\"),\n                    continueText: _t(\"Confirm\"),\n                    continueKind: \"primary\",\n                },\n            };\n\n            const { finished } = Modal.createTrackedDialog(\n                'Cross-signing keys dialog', '', InteractiveAuthDialog,\n                {\n                    title: _t(\"Setting up keys\"),\n                    matrixClient: MatrixClientPeg.get(),\n                    makeRequest,\n                    aestheticsForStagePhases: {\n                        [SSOAuthEntry.LOGIN_TYPE]: dialogAesthetics,\n                        [SSOAuthEntry.UNSTABLE_LOGIN_TYPE]: dialogAesthetics,\n                    },\n                },\n            );\n            const [confirmed] = await finished;\n            if (!confirmed) {\n                throw new Error(\"Cross-signing key upload auth canceled\");\n            }\n        }\n    };\n\n    private bootstrapSecretStorage = async (): Promise<void> => {\n        this.setState({\n            phase: Phase.Storing,\n            error: null,\n        });\n\n        const cli = MatrixClientPeg.get();\n\n        const { forceReset } = this.props;\n\n        try {\n            if (forceReset) {\n                logger.log(\"Forcing secret storage reset\");\n                await cli.bootstrapSecretStorage({\n                    createSecretStorageKey: async () => this.recoveryKey,\n                    setupNewKeyBackup: true,\n                    setupNewSecretStorage: true,\n                });\n            } else {\n                // For password authentication users after 2020-09, this cross-signing\n                // step will be a no-op since it is now setup during registration or login\n                // when needed. We should keep this here to cover other cases such as:\n                //   * Users with existing sessions prior to 2020-09 changes\n                //   * SSO authentication users which require interactive auth to upload\n                //     keys (and also happen to skip all post-authentication flows at the\n                //     moment via token login)\n                await cli.bootstrapCrossSigning({\n                    authUploadDeviceSigningKeys: this.doBootstrapUIAuth,\n                });\n                await cli.bootstrapSecretStorage({\n                    createSecretStorageKey: async () => this.recoveryKey,\n                    keyBackupInfo: this.state.backupInfo,\n                    setupNewKeyBackup: !this.state.backupInfo,\n                    getKeyBackupPassphrase: async () => {\n                        // We may already have the backup key if we earlier went\n                        // through the restore backup path, so pass it along\n                        // rather than prompting again.\n                        if (this.backupKey) {\n                            return this.backupKey;\n                        }\n                        return promptForBackupPassphrase();\n                    },\n                });\n            }\n            this.props.onFinished(true);\n        } catch (e) {\n            if (this.state.canUploadKeysWithPasswordOnly && e.httpStatus === 401 && e.data.flows) {\n                this.setState({\n                    accountPassword: '',\n                    accountPasswordCorrect: false,\n                    phase: Phase.Migrate,\n                });\n            } else {\n                this.setState({ error: e });\n            }\n            logger.error(\"Error bootstrapping secret storage\", e);\n        }\n    };\n\n    private onCancel = (): void => {\n        this.props.onFinished(false);\n    };\n\n    private restoreBackup = async (): Promise<void> => {\n        // It's possible we'll need the backup key later on for bootstrapping,\n        // so let's stash it here, rather than prompting for it twice.\n        const keyCallback = k => this.backupKey = k;\n\n        const { finished } = Modal.createTrackedDialog(\n            'Restore Backup', '', RestoreKeyBackupDialog,\n            {\n                showSummary: false,\n                keyCallback,\n            },\n            null, /* priority = */ false, /* static = */ false,\n        );\n\n        await finished;\n        const { backupSigStatus } = await this.fetchBackupInfo();\n        if (\n            backupSigStatus.usable &&\n            this.state.canUploadKeysWithPasswordOnly &&\n            this.state.accountPassword\n        ) {\n            this.bootstrapSecretStorage();\n        }\n    };\n\n    private onLoadRetryClick = (): void => {\n        this.setState({ phase: Phase.Loading });\n        this.fetchBackupInfo();\n    };\n\n    private onShowKeyContinueClick = (): void => {\n        this.bootstrapSecretStorage();\n    };\n\n    private onCancelClick = (): void => {\n        this.setState({ phase: Phase.ConfirmSkip });\n    };\n\n    private onGoBackClick = (): void => {\n        this.setState({ phase: Phase.ChooseKeyPassphrase });\n    };\n\n    private onPassPhraseNextClick = async (e: React.FormEvent) => {\n        e.preventDefault();\n        if (!this.passphraseField.current) return; // unmounting\n\n        await this.passphraseField.current.validate({ allowEmpty: false });\n        if (!this.passphraseField.current.state.valid) {\n            this.passphraseField.current.focus();\n            this.passphraseField.current.validate({ allowEmpty: false, focused: true });\n            return;\n        }\n\n        this.setState({ phase: Phase.PassphraseConfirm });\n    };\n\n    private onPassPhraseConfirmNextClick = async (e: React.FormEvent) => {\n        e.preventDefault();\n\n        if (this.state.passPhrase !== this.state.passPhraseConfirm) return;\n\n        this.recoveryKey =\n            await MatrixClientPeg.get().createRecoveryKeyFromPassphrase(this.state.passPhrase);\n        this.setState({\n            copied: false,\n            downloaded: false,\n            setPassphrase: true,\n            phase: Phase.ShowKey,\n        });\n    };\n\n    private onSetAgainClick = (): void => {\n        this.setState({\n            passPhrase: '',\n            passPhraseValid: false,\n            passPhraseConfirm: '',\n            phase: Phase.Passphrase,\n        });\n    };\n\n    private onPassPhraseValidate = (result: IValidationResult): void => {\n        this.setState({\n            passPhraseValid: result.valid,\n        });\n    };\n\n    private onPassPhraseChange = (e: React.ChangeEvent<HTMLInputElement>): void => {\n        this.setState({\n            passPhrase: e.target.value,\n        });\n    };\n\n    private onPassPhraseConfirmChange = (e: React.ChangeEvent<HTMLInputElement>): void => {\n        this.setState({\n            passPhraseConfirm: e.target.value,\n        });\n    };\n\n    private onAccountPasswordChange = (e: React.ChangeEvent<HTMLInputElement>): void => {\n        this.setState({\n            accountPassword: e.target.value,\n        });\n    };\n\n    private renderOptionKey(): JSX.Element {\n        return (\n            <StyledRadioButton\n                key={SecureBackupSetupMethod.Key}\n                value={SecureBackupSetupMethod.Key}\n                name=\"keyPassphrase\"\n                checked={this.state.passPhraseKeySelected === SecureBackupSetupMethod.Key}\n                onChange={this.onKeyPassphraseChange}\n                outlined\n            >\n                <div className=\"mx_CreateSecretStorageDialog_optionTitle\">\n                    <span className=\"mx_CreateSecretStorageDialog_optionIcon mx_CreateSecretStorageDialog_optionIcon_secureBackup\" />\n                    { _t(\"Generate a Security Key\") }\n                </div>\n                <div>{ _t(\"We'll generate a Security Key for you to store somewhere safe, like a password manager or a safe.\") }</div>\n            </StyledRadioButton>\n        );\n    }\n\n    private renderOptionPassphrase(): JSX.Element {\n        return (\n            <StyledRadioButton\n                key={SecureBackupSetupMethod.Passphrase}\n                value={SecureBackupSetupMethod.Passphrase}\n                name=\"keyPassphrase\"\n                checked={this.state.passPhraseKeySelected === SecureBackupSetupMethod.Passphrase}\n                onChange={this.onKeyPassphraseChange}\n                outlined\n            >\n                <div className=\"mx_CreateSecretStorageDialog_optionTitle\">\n                    <span className=\"mx_CreateSecretStorageDialog_optionIcon mx_CreateSecretStorageDialog_optionIcon_securePhrase\" />\n                    { _t(\"Enter a Security Phrase\") }\n                </div>\n                <div>{ _t(\"Use a secret phrase only you know, and optionally save a Security Key to use for backup.\") }</div>\n            </StyledRadioButton>\n        );\n    }\n\n    private renderPhaseChooseKeyPassphrase(): JSX.Element {\n        const setupMethods = getSecureBackupSetupMethods();\n        const optionKey = setupMethods.includes(SecureBackupSetupMethod.Key) ? this.renderOptionKey() : null;\n        const optionPassphrase = setupMethods.includes(SecureBackupSetupMethod.Passphrase)\n            ? this.renderOptionPassphrase()\n            : null;\n\n        return <form onSubmit={this.onChooseKeyPassphraseFormSubmit}>\n            <p className=\"mx_CreateSecretStorageDialog_centeredBody\">{ _t(\n                \"Safeguard against losing access to encrypted messages & data by \" +\n                \"backing up encryption keys on your server.\",\n            ) }</p>\n            <div className=\"mx_CreateSecretStorageDialog_primaryContainer\" role=\"radiogroup\">\n                { optionKey }\n                { optionPassphrase }\n            </div>\n            <DialogButtons\n                primaryButton={_t(\"Continue\")}\n                onPrimaryButtonClick={this.onChooseKeyPassphraseFormSubmit}\n                onCancel={this.onCancelClick}\n                hasCancel={this.state.canSkip}\n            />\n        </form>;\n    }\n\n    private renderPhaseMigrate(): JSX.Element {\n        // TODO: This is a temporary screen so people who have the labs flag turned on and\n        // click the button are aware they're making a change to their account.\n        // Once we're confident enough in this (and it's supported enough) we can do\n        // it automatically.\n        // https://github.com/vector-im/element-web/issues/11696\n\n        let authPrompt;\n        let nextCaption = _t(\"Next\");\n        if (this.state.canUploadKeysWithPasswordOnly) {\n            authPrompt = <div>\n                <div>{ _t(\"Enter your account password to confirm the upgrade:\") }</div>\n                <div><Field\n                    type=\"password\"\n                    label={_t(\"Password\")}\n                    value={this.state.accountPassword}\n                    onChange={this.onAccountPasswordChange}\n                    forceValidity={this.state.accountPasswordCorrect === false ? false : null}\n                    autoFocus={true}\n                /></div>\n            </div>;\n        } else if (!this.state.backupSigStatus.usable) {\n            authPrompt = <div>\n                <div>{ _t(\"Restore your key backup to upgrade your encryption\") }</div>\n            </div>;\n            nextCaption = _t(\"Restore\");\n        } else {\n            authPrompt = <p>\n                { _t(\"You'll need to authenticate with the server to confirm the upgrade.\") }\n            </p>;\n        }\n\n        return <form onSubmit={this.onMigrateFormSubmit}>\n            <p>{ _t(\n                \"Upgrade this session to allow it to verify other sessions, \" +\n                \"granting them access to encrypted messages and marking them \" +\n                \"as trusted for other users.\",\n            ) }</p>\n            <div>{ authPrompt }</div>\n            <DialogButtons\n                primaryButton={nextCaption}\n                onPrimaryButtonClick={this.onMigrateFormSubmit}\n                hasCancel={false}\n                primaryDisabled={this.state.canUploadKeysWithPasswordOnly && !this.state.accountPassword}\n            >\n                <button type=\"button\" className=\"danger\" onClick={this.onCancelClick}>\n                    { _t('Skip') }\n                </button>\n            </DialogButtons>\n        </form>;\n    }\n\n    private renderPhasePassPhrase(): JSX.Element {\n        return <form onSubmit={this.onPassPhraseNextClick}>\n            <p>{ _t(\n                \"Enter a security phrase only you know, as it's used to safeguard your data. \" +\n                \"To be secure, you shouldn't re-use your account password.\",\n            ) }</p>\n\n            <div className=\"mx_CreateSecretStorageDialog_passPhraseContainer\">\n                <PassphraseField\n                    className=\"mx_CreateSecretStorageDialog_passPhraseField\"\n                    onChange={this.onPassPhraseChange}\n                    minScore={PASSWORD_MIN_SCORE}\n                    value={this.state.passPhrase}\n                    onValidate={this.onPassPhraseValidate}\n                    fieldRef={this.passphraseField}\n                    autoFocus={true}\n                    label={_td(\"Enter a Security Phrase\")}\n                    labelEnterPassword={_td(\"Enter a Security Phrase\")}\n                    labelStrongPassword={_td(\"Great! This Security Phrase looks strong enough.\")}\n                    labelAllowedButUnsafe={_td(\"Great! This Security Phrase looks strong enough.\")}\n                />\n            </div>\n\n            <DialogButtons\n                primaryButton={_t('Continue')}\n                onPrimaryButtonClick={this.onPassPhraseNextClick}\n                hasCancel={false}\n                disabled={!this.state.passPhraseValid}\n            >\n                <button type=\"button\"\n                    onClick={this.onCancelClick}\n                    className=\"danger\"\n                >{ _t(\"Cancel\") }</button>\n            </DialogButtons>\n        </form>;\n    }\n\n    private renderPhasePassPhraseConfirm(): JSX.Element {\n        let matchText;\n        let changeText;\n        if (this.state.passPhraseConfirm === this.state.passPhrase) {\n            matchText = _t(\"That matches!\");\n            changeText = _t(\"Use a different passphrase?\");\n        } else if (!this.state.passPhrase.startsWith(this.state.passPhraseConfirm)) {\n            // only tell them they're wrong if they've actually gone wrong.\n            // Security concious readers will note that if you left element-web unattended\n            // on this screen, this would make it easy for a malicious person to guess\n            // your passphrase one letter at a time, but they could get this faster by\n            // just opening the browser's developer tools and reading it.\n            // Note that not having typed anything at all will not hit this clause and\n            // fall through so empty box === no hint.\n            matchText = _t(\"That doesn't match.\");\n            changeText = _t(\"Go back to set it again.\");\n        }\n\n        let passPhraseMatch = null;\n        if (matchText) {\n            passPhraseMatch = <div>\n                <div>{ matchText }</div>\n                <div>\n                    <AccessibleButton element=\"span\" className=\"mx_linkButton\" onClick={this.onSetAgainClick}>\n                        { changeText }\n                    </AccessibleButton>\n                </div>\n            </div>;\n        }\n        return <form onSubmit={this.onPassPhraseConfirmNextClick}>\n            <p>{ _t(\n                \"Enter your Security Phrase a second time to confirm it.\",\n            ) }</p>\n            <div className=\"mx_CreateSecretStorageDialog_passPhraseContainer\">\n                <Field\n                    type=\"password\"\n                    onChange={this.onPassPhraseConfirmChange}\n                    value={this.state.passPhraseConfirm}\n                    className=\"mx_CreateSecretStorageDialog_passPhraseField\"\n                    label={_t(\"Confirm your Security Phrase\")}\n                    autoFocus={true}\n                    autoComplete=\"new-password\"\n                />\n                <div className=\"mx_CreateSecretStorageDialog_passPhraseMatch\">\n                    { passPhraseMatch }\n                </div>\n            </div>\n            <DialogButtons\n                primaryButton={_t('Continue')}\n                onPrimaryButtonClick={this.onPassPhraseConfirmNextClick}\n                hasCancel={false}\n                disabled={this.state.passPhrase !== this.state.passPhraseConfirm}\n            >\n                <button type=\"button\"\n                    onClick={this.onCancelClick}\n                    className=\"danger\"\n                >{ _t(\"Skip\") }</button>\n            </DialogButtons>\n        </form>;\n    }\n\n    private renderPhaseShowKey(): JSX.Element {\n        let continueButton;\n        if (this.state.phase === Phase.ShowKey) {\n            continueButton = <DialogButtons primaryButton={_t(\"Continue\")}\n                disabled={!this.state.downloaded && !this.state.copied && !this.state.setPassphrase}\n                onPrimaryButtonClick={this.onShowKeyContinueClick}\n                hasCancel={false}\n            />;\n        } else {\n            continueButton = <div className=\"mx_CreateSecretStorageDialog_continueSpinner\">\n                <InlineSpinner />\n            </div>;\n        }\n\n        return <div>\n            <p>{ _t(\n                \"Store your Security Key somewhere safe, like a password manager or a safe, \" +\n                \"as it's used to safeguard your encrypted data.\",\n            ) }</p>\n            <div className=\"mx_CreateSecretStorageDialog_primaryContainer mx_CreateSecretStorageDialog_recoveryKeyPrimarycontainer\">\n                <div className=\"mx_CreateSecretStorageDialog_recoveryKeyContainer\">\n                    <div className=\"mx_CreateSecretStorageDialog_recoveryKey\">\n                        <code ref={this.recoveryKeyNode}>{ this.recoveryKey.encodedPrivateKey }</code>\n                    </div>\n                    <div className=\"mx_CreateSecretStorageDialog_recoveryKeyButtons\">\n                        <AccessibleButton kind='primary'\n                            className=\"mx_Dialog_primary\"\n                            onClick={this.onDownloadClick}\n                            disabled={this.state.phase === Phase.Storing}\n                        >\n                            { _t(\"Download\") }\n                        </AccessibleButton>\n                        <span>{ _t(\"or\") }</span>\n                        <AccessibleButton\n                            kind='primary'\n                            className=\"mx_Dialog_primary mx_CreateSecretStorageDialog_recoveryKeyButtons_copyBtn\"\n                            onClick={this.onCopyClick}\n                            disabled={this.state.phase === Phase.Storing}\n                        >\n                            { this.state.copied ? _t(\"Copied!\") : _t(\"Copy\") }\n                        </AccessibleButton>\n                    </div>\n                </div>\n            </div>\n            { continueButton }\n        </div>;\n    }\n\n    private renderBusyPhase(): JSX.Element {\n        return <div>\n            <Spinner />\n        </div>;\n    }\n\n    private renderPhaseLoadError(): JSX.Element {\n        return <div>\n            <p>{ _t(\"Unable to query secret storage status\") }</p>\n            <div className=\"mx_Dialog_buttons\">\n                <DialogButtons primaryButton={_t('Retry')}\n                    onPrimaryButtonClick={this.onLoadRetryClick}\n                    hasCancel={this.state.canSkip}\n                    onCancel={this.onCancel}\n                />\n            </div>\n        </div>;\n    }\n\n    private renderPhaseSkipConfirm(): JSX.Element {\n        return <div>\n            <p>{ _t(\n                \"If you cancel now, you may lose encrypted messages & data if you lose access to your logins.\",\n            ) }</p>\n            <p>{ _t(\n                \"You can also set up Secure Backup & manage your keys in Settings.\",\n            ) }</p>\n            <DialogButtons primaryButton={_t('Go back')}\n                onPrimaryButtonClick={this.onGoBackClick}\n                hasCancel={false}\n            >\n                <button type=\"button\" className=\"danger\" onClick={this.onCancel}>{ _t('Cancel') }</button>\n            </DialogButtons>\n        </div>;\n    }\n\n    private titleForPhase(phase: Phase): string {\n        switch (phase) {\n            case Phase.ChooseKeyPassphrase:\n                return _t('Set up Secure Backup');\n            case Phase.Migrate:\n                return _t('Upgrade your encryption');\n            case Phase.Passphrase:\n                return _t('Set a Security Phrase');\n            case Phase.PassphraseConfirm:\n                return _t('Confirm Security Phrase');\n            case Phase.ConfirmSkip:\n                return _t('Are you sure?');\n            case Phase.ShowKey:\n                return _t('Save your Security Key');\n            case Phase.Storing:\n                return _t('Setting up keys');\n            default:\n                return '';\n        }\n    }\n\n    public render(): JSX.Element {\n        let content;\n        if (this.state.error) {\n            content = <div>\n                <p>{ _t(\"Unable to set up secret storage\") }</p>\n                <div className=\"mx_Dialog_buttons\">\n                    <DialogButtons primaryButton={_t('Retry')}\n                        onPrimaryButtonClick={this.bootstrapSecretStorage}\n                        hasCancel={this.state.canSkip}\n                        onCancel={this.onCancel}\n                    />\n                </div>\n            </div>;\n        } else {\n            switch (this.state.phase) {\n                case Phase.Loading:\n                    content = this.renderBusyPhase();\n                    break;\n                case Phase.LoadError:\n                    content = this.renderPhaseLoadError();\n                    break;\n                case Phase.ChooseKeyPassphrase:\n                    content = this.renderPhaseChooseKeyPassphrase();\n                    break;\n                case Phase.Migrate:\n                    content = this.renderPhaseMigrate();\n                    break;\n                case Phase.Passphrase:\n                    content = this.renderPhasePassPhrase();\n                    break;\n                case Phase.PassphraseConfirm:\n                    content = this.renderPhasePassPhraseConfirm();\n                    break;\n                case Phase.ShowKey:\n                    content = this.renderPhaseShowKey();\n                    break;\n                case Phase.Storing:\n                    content = this.renderBusyPhase();\n                    break;\n                case Phase.ConfirmSkip:\n                    content = this.renderPhaseSkipConfirm();\n                    break;\n            }\n        }\n\n        let titleClass = null;\n        switch (this.state.phase) {\n            case Phase.Passphrase:\n            case Phase.PassphraseConfirm:\n                titleClass = [\n                    'mx_CreateSecretStorageDialog_titleWithIcon',\n                    'mx_CreateSecretStorageDialog_securePhraseTitle',\n                ];\n                break;\n            case Phase.ShowKey:\n                titleClass = [\n                    'mx_CreateSecretStorageDialog_titleWithIcon',\n                    'mx_CreateSecretStorageDialog_secureBackupTitle',\n                ];\n                break;\n            case Phase.ChooseKeyPassphrase:\n                titleClass = 'mx_CreateSecretStorageDialog_centeredTitle';\n                break;\n        }\n\n        return (\n            <BaseDialog className='mx_CreateSecretStorageDialog'\n                onFinished={this.props.onFinished}\n                title={this.titleForPhase(this.state.phase)}\n                titleClass={titleClass}\n                hasCancel={this.props.hasCancel && [Phase.Passphrase].includes(this.state.phase)}\n                fixedWidth={false}\n            >\n                <div>\n                    { content }\n                </div>\n            </BaseDialog>\n        );\n    }\n}\n"],"sourceRoot":""}