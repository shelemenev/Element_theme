{"version":3,"sources":["webpack:///./matrix-react-sdk/src/async-components/views/dialogs/security/CreateKeyBackupDialog.tsx"],"names":["Phase","PASSWORD_MIN_SCORE","CreateKeyBackupDialog","React","PureComponent","constructor","props","createRef","successful","copyNode","recoveryKeyNode","current","setState","copied","phase","KeepItSafe","blob","Blob","keyBackupInfo","recovery_key","type","FileSaver","saveAs","downloaded","secureSecretStorage","state","BackingUp","error","info","accessSecretStorage","MatrixClientPeg","get","prepareKeyBackupVersion","createKeyBackupVersion","scheduleAllGroupSessionsForBackup","Done","e","logger","deleteKeyBackupVersion","version","onFinished","Passphrase","ShowKey","preventDefault","passphraseField","validate","allowEmpty","valid","focus","focused","PassphraseConfirm","passPhrase","passPhraseConfirm","passPhraseValid","result","target","value","componentDidMount","cli","doesServerSupportUnstableFeature","createBackup","renderPhasePassPhrase","onPassPhraseNextClick","_t","b","sub","onPassPhraseChange","onPassPhraseValidate","_td","onSkipPassPhraseClick","renderPhasePassPhraseConfirm","matchText","changeText","startsWith","passPhraseMatch","onSetAgainClick","onPassPhraseConfirmNextClick","onPassPhraseConfirmChange","renderPhaseShowKey","onCopyClick","onDownloadClick","renderPhaseKeepItSafe","introText","s","onKeepItSafeBackClick","renderBusyPhase","renderPhaseDone","onDone","renderPhaseOptOutConfirm","onSetUpClick","onCancel","titleForPhase","OptOutConfirm","render","content","includes"],"mappings":"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","file":"bundles/44e8ec706535e1389ea6/6.js","sourcesContent":["/*\nCopyright 2018, 2019 New Vector Ltd\nCopyright 2019, 2020 The Matrix.org Foundation C.I.C.\n\nLicensed under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License.\nYou may obtain a copy of the License at\n\n    http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software\ndistributed under the License is distributed on an \"AS IS\" BASIS,\nWITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\nSee the License for the specific language governing permissions and\nlimitations under the License.\n*/\n\nimport React, { createRef } from 'react';\nimport FileSaver from 'file-saver';\nimport { IPreparedKeyBackupVersion } from \"matrix-js-sdk/src/crypto/backup\";\nimport { logger } from \"matrix-js-sdk/src/logger\";\n\nimport { MatrixClientPeg } from '../../../../MatrixClientPeg';\nimport { _t, _td } from '../../../../languageHandler';\nimport { accessSecretStorage } from '../../../../SecurityManager';\nimport AccessibleButton from \"../../../../components/views/elements/AccessibleButton\";\nimport { copyNode } from \"../../../../utils/strings\";\nimport PassphraseField from \"../../../../components/views/auth/PassphraseField\";\nimport { IDialogProps } from \"../../../../components/views/dialogs/IDialogProps\";\nimport Field from \"../../../../components/views/elements/Field\";\nimport Spinner from \"../../../../components/views/elements/Spinner\";\nimport BaseDialog from \"../../../../components/views/dialogs/BaseDialog\";\nimport DialogButtons from \"../../../../components/views/elements/DialogButtons\";\nimport { IValidationResult } from \"../../../../components/views/elements/Validation\";\n\nenum Phase {\n    Passphrase = \"passphrase\",\n    PassphraseConfirm = \"passphrase_confirm\",\n    ShowKey = \"show_key\",\n    KeepItSafe = \"keep_it_safe\",\n    BackingUp = \"backing_up\",\n    Done = \"done\",\n    OptOutConfirm = \"opt_out_confirm\",\n}\n\nconst PASSWORD_MIN_SCORE = 4; // So secure, many characters, much complex, wow, etc, etc.\n\ninterface IProps extends IDialogProps {}\n\ninterface IState {\n    secureSecretStorage: boolean;\n    phase: Phase;\n    passPhrase: string;\n    passPhraseValid: boolean;\n    passPhraseConfirm: string;\n    copied: boolean;\n    downloaded: boolean;\n    error?: string;\n}\n\n/*\n * Walks the user through the process of creating an e2e key backup\n * on the server.\n */\nexport default class CreateKeyBackupDialog extends React.PureComponent<IProps, IState> {\n    private keyBackupInfo: Pick<IPreparedKeyBackupVersion, \"recovery_key\" | \"algorithm\" | \"auth_data\">;\n    private recoveryKeyNode = createRef<HTMLElement>();\n    private passphraseField = createRef<Field>();\n\n    constructor(props: IProps) {\n        super(props);\n\n        this.state = {\n            secureSecretStorage: null,\n            phase: Phase.Passphrase,\n            passPhrase: '',\n            passPhraseValid: false,\n            passPhraseConfirm: '',\n            copied: false,\n            downloaded: false,\n        };\n    }\n\n    public async componentDidMount(): Promise<void> {\n        const cli = MatrixClientPeg.get();\n        const secureSecretStorage = await cli.doesServerSupportUnstableFeature(\"org.matrix.e2e_cross_signing\");\n        this.setState({ secureSecretStorage });\n\n        // If we're using secret storage, skip ahead to the backing up step, as\n        // `accessSecretStorage` will handle passphrases as needed.\n        if (secureSecretStorage) {\n            this.setState({ phase: Phase.BackingUp });\n            this.createBackup();\n        }\n    }\n\n    private onCopyClick = (): void => {\n        const successful = copyNode(this.recoveryKeyNode.current);\n        if (successful) {\n            this.setState({\n                copied: true,\n                phase: Phase.KeepItSafe,\n            });\n        }\n    };\n\n    private onDownloadClick = (): void => {\n        const blob = new Blob([this.keyBackupInfo.recovery_key], {\n            type: 'text/plain;charset=us-ascii',\n        });\n        FileSaver.saveAs(blob, 'security-key.txt');\n\n        this.setState({\n            downloaded: true,\n            phase: Phase.KeepItSafe,\n        });\n    };\n\n    private createBackup = async (): Promise<void> => {\n        const { secureSecretStorage } = this.state;\n        this.setState({\n            phase: Phase.BackingUp,\n            error: null,\n        });\n        let info;\n        try {\n            if (secureSecretStorage) {\n                await accessSecretStorage(async () => {\n                    info = await MatrixClientPeg.get().prepareKeyBackupVersion(\n                        null /* random key */,\n                        { secureSecretStorage: true },\n                    );\n                    info = await MatrixClientPeg.get().createKeyBackupVersion(info);\n                });\n            } else {\n                info = await MatrixClientPeg.get().createKeyBackupVersion(\n                    this.keyBackupInfo,\n                );\n            }\n            await MatrixClientPeg.get().scheduleAllGroupSessionsForBackup();\n            this.setState({\n                phase: Phase.Done,\n            });\n        } catch (e) {\n            logger.error(\"Error creating key backup\", e);\n            // TODO: If creating a version succeeds, but backup fails, should we\n            // delete the version, disable backup, or do nothing?  If we just\n            // disable without deleting, we'll enable on next app reload since\n            // it is trusted.\n            if (info) {\n                MatrixClientPeg.get().deleteKeyBackupVersion(info.version);\n            }\n            this.setState({\n                error: e,\n            });\n        }\n    };\n\n    private onCancel = (): void => {\n        this.props.onFinished(false);\n    };\n\n    private onDone = (): void => {\n        this.props.onFinished(true);\n    };\n\n    private onSetUpClick = (): void => {\n        this.setState({ phase: Phase.Passphrase });\n    };\n\n    private onSkipPassPhraseClick = async (): Promise<void> => {\n        this.keyBackupInfo = await MatrixClientPeg.get().prepareKeyBackupVersion();\n        this.setState({\n            copied: false,\n            downloaded: false,\n            phase: Phase.ShowKey,\n        });\n    };\n\n    private onPassPhraseNextClick = async (e: React.FormEvent): Promise<void> => {\n        e.preventDefault();\n        if (!this.passphraseField.current) return; // unmounting\n\n        await this.passphraseField.current.validate({ allowEmpty: false });\n        if (!this.passphraseField.current.state.valid) {\n            this.passphraseField.current.focus();\n            this.passphraseField.current.validate({ allowEmpty: false, focused: true });\n            return;\n        }\n\n        this.setState({ phase: Phase.PassphraseConfirm });\n    };\n\n    private onPassPhraseConfirmNextClick = async (e: React.FormEvent): Promise<void> => {\n        e.preventDefault();\n\n        if (this.state.passPhrase !== this.state.passPhraseConfirm) return;\n\n        this.keyBackupInfo = await MatrixClientPeg.get().prepareKeyBackupVersion(this.state.passPhrase);\n        this.setState({\n            copied: false,\n            downloaded: false,\n            phase: Phase.ShowKey,\n        });\n    };\n\n    private onSetAgainClick = (): void => {\n        this.setState({\n            passPhrase: '',\n            passPhraseValid: false,\n            passPhraseConfirm: '',\n            phase: Phase.Passphrase,\n        });\n    };\n\n    private onKeepItSafeBackClick = (): void => {\n        this.setState({\n            phase: Phase.ShowKey,\n        });\n    };\n\n    private onPassPhraseValidate = (result: IValidationResult): void => {\n        this.setState({\n            passPhraseValid: result.valid,\n        });\n    };\n\n    private onPassPhraseChange = (e: React.ChangeEvent<HTMLInputElement>): void => {\n        this.setState({\n            passPhrase: e.target.value,\n        });\n    };\n\n    private onPassPhraseConfirmChange = (e: React.ChangeEvent<HTMLInputElement>): void => {\n        this.setState({\n            passPhraseConfirm: e.target.value,\n        });\n    };\n\n    private renderPhasePassPhrase(): JSX.Element {\n        return <form onSubmit={this.onPassPhraseNextClick}>\n            <p>{ _t(\n                \"<b>Warning</b>: You should only set up key backup from a trusted computer.\", {},\n                { b: sub => <b>{ sub }</b> },\n            ) }</p>\n            <p>{ _t(\n                \"We'll store an encrypted copy of your keys on our server. \" +\n                \"Secure your backup with a Security Phrase.\",\n            ) }</p>\n            <p>{ _t(\"For maximum security, this should be different from your account password.\") }</p>\n\n            <div className=\"mx_CreateKeyBackupDialog_primaryContainer\">\n                <div className=\"mx_CreateKeyBackupDialog_passPhraseContainer\">\n                    <PassphraseField\n                        className=\"mx_CreateKeyBackupDialog_passPhraseInput\"\n                        onChange={this.onPassPhraseChange}\n                        minScore={PASSWORD_MIN_SCORE}\n                        value={this.state.passPhrase}\n                        onValidate={this.onPassPhraseValidate}\n                        fieldRef={this.passphraseField}\n                        autoFocus={true}\n                        label={_td(\"Enter a Security Phrase\")}\n                        labelEnterPassword={_td(\"Enter a Security Phrase\")}\n                        labelStrongPassword={_td(\"Great! This Security Phrase looks strong enough.\")}\n                        labelAllowedButUnsafe={_td(\"Great! This Security Phrase looks strong enough.\")}\n                    />\n                </div>\n            </div>\n\n            <DialogButtons\n                primaryButton={_t('Next')}\n                onPrimaryButtonClick={this.onPassPhraseNextClick}\n                hasCancel={false}\n                disabled={!this.state.passPhraseValid}\n            />\n\n            <details>\n                <summary>{ _t(\"Advanced\") }</summary>\n                <AccessibleButton kind='primary' onClick={this.onSkipPassPhraseClick}>\n                    { _t(\"Set up with a Security Key\") }\n                </AccessibleButton>\n            </details>\n        </form>;\n    }\n\n    private renderPhasePassPhraseConfirm(): JSX.Element {\n        let matchText;\n        let changeText;\n        if (this.state.passPhraseConfirm === this.state.passPhrase) {\n            matchText = _t(\"That matches!\");\n            changeText = _t(\"Use a different passphrase?\");\n        } else if (!this.state.passPhrase.startsWith(this.state.passPhraseConfirm)) {\n            // only tell them they're wrong if they've actually gone wrong.\n            // Security concious readers will note that if you left element-web unattended\n            // on this screen, this would make it easy for a malicious person to guess\n            // your passphrase one letter at a time, but they could get this faster by\n            // just opening the browser's developer tools and reading it.\n            // Note that not having typed anything at all will not hit this clause and\n            // fall through so empty box === no hint.\n            matchText = _t(\"That doesn't match.\");\n            changeText = _t(\"Go back to set it again.\");\n        }\n\n        let passPhraseMatch = null;\n        if (matchText) {\n            passPhraseMatch = <div className=\"mx_CreateKeyBackupDialog_passPhraseMatch\">\n                <div>{ matchText }</div>\n                <div>\n                    <AccessibleButton element=\"span\" className=\"mx_linkButton\" onClick={this.onSetAgainClick}>\n                        { changeText }\n                    </AccessibleButton>\n                </div>\n            </div>;\n        }\n        return <form onSubmit={this.onPassPhraseConfirmNextClick}>\n            <p>{ _t(\n                \"Enter your Security Phrase a second time to confirm it.\",\n            ) }</p>\n            <div className=\"mx_CreateKeyBackupDialog_primaryContainer\">\n                <div className=\"mx_CreateKeyBackupDialog_passPhraseContainer\">\n                    <div>\n                        <input type=\"password\"\n                            onChange={this.onPassPhraseConfirmChange}\n                            value={this.state.passPhraseConfirm}\n                            className=\"mx_CreateKeyBackupDialog_passPhraseInput\"\n                            placeholder={_t(\"Repeat your Security Phrase...\")}\n                            autoFocus={true}\n                        />\n                    </div>\n                    { passPhraseMatch }\n                </div>\n            </div>\n            <DialogButtons\n                primaryButton={_t('Next')}\n                onPrimaryButtonClick={this.onPassPhraseConfirmNextClick}\n                hasCancel={false}\n                disabled={this.state.passPhrase !== this.state.passPhraseConfirm}\n            />\n        </form>;\n    }\n\n    private renderPhaseShowKey(): JSX.Element {\n        return <div>\n            <p>{ _t(\n                \"Your Security Key is a safety net - you can use it to restore \" +\n                \"access to your encrypted messages if you forget your Security Phrase.\",\n            ) }</p>\n            <p>{ _t(\n                \"Keep a copy of it somewhere secure, like a password manager or even a safe.\",\n            ) }</p>\n            <div className=\"mx_CreateKeyBackupDialog_primaryContainer\">\n                <div className=\"mx_CreateKeyBackupDialog_recoveryKeyHeader\">\n                    { _t(\"Your Security Key\") }\n                </div>\n                <div className=\"mx_CreateKeyBackupDialog_recoveryKeyContainer\">\n                    <div className=\"mx_CreateKeyBackupDialog_recoveryKey\">\n                        <code ref={this.recoveryKeyNode}>{ this.keyBackupInfo.recovery_key }</code>\n                    </div>\n                    <div className=\"mx_CreateKeyBackupDialog_recoveryKeyButtons\">\n                        <button className=\"mx_Dialog_primary\" onClick={this.onCopyClick}>\n                            { _t(\"Copy\") }\n                        </button>\n                        <button className=\"mx_Dialog_primary\" onClick={this.onDownloadClick}>\n                            { _t(\"Download\") }\n                        </button>\n                    </div>\n                </div>\n            </div>\n        </div>;\n    }\n\n    private renderPhaseKeepItSafe(): JSX.Element {\n        let introText;\n        if (this.state.copied) {\n            introText = _t(\n                \"Your Security Key has been <b>copied to your clipboard</b>, paste it to:\",\n                {}, { b: s => <b>{ s }</b> },\n            );\n        } else if (this.state.downloaded) {\n            introText = _t(\n                \"Your Security Key is in your <b>Downloads</b> folder.\",\n                {}, { b: s => <b>{ s }</b> },\n            );\n        }\n        return <div>\n            { introText }\n            <ul>\n                <li>{ _t(\"<b>Print it</b> and store it somewhere safe\", {}, { b: s => <b>{ s }</b> }) }</li>\n                <li>{ _t(\"<b>Save it</b> on a USB key or backup drive\", {}, { b: s => <b>{ s }</b> }) }</li>\n                <li>{ _t(\"<b>Copy it</b> to your personal cloud storage\", {}, { b: s => <b>{ s }</b> }) }</li>\n            </ul>\n            <DialogButtons primaryButton={_t(\"Continue\")}\n                onPrimaryButtonClick={this.createBackup}\n                hasCancel={false}>\n                <button onClick={this.onKeepItSafeBackClick}>{ _t(\"Back\") }</button>\n            </DialogButtons>\n        </div>;\n    }\n\n    private renderBusyPhase(): JSX.Element {\n        return <div>\n            <Spinner />\n        </div>;\n    }\n\n    private renderPhaseDone(): JSX.Element {\n        return <div>\n            <p>{ _t(\n                \"Your keys are being backed up (the first backup could take a few minutes).\",\n            ) }</p>\n            <DialogButtons primaryButton={_t('OK')}\n                onPrimaryButtonClick={this.onDone}\n                hasCancel={false}\n            />\n        </div>;\n    }\n\n    private renderPhaseOptOutConfirm(): JSX.Element {\n        return <div>\n            { _t(\n                \"Without setting up Secure Message Recovery, you won't be able to restore your \" +\n                \"encrypted message history if you log out or use another session.\",\n            ) }\n            <DialogButtons primaryButton={_t('Set up Secure Message Recovery')}\n                onPrimaryButtonClick={this.onSetUpClick}\n                hasCancel={false}\n            >\n                <button onClick={this.onCancel}>I understand, continue without</button>\n            </DialogButtons>\n        </div>;\n    }\n\n    private titleForPhase(phase: Phase): string {\n        switch (phase) {\n            case Phase.Passphrase:\n                return _t('Secure your backup with a Security Phrase');\n            case Phase.PassphraseConfirm:\n                return _t('Confirm your Security Phrase');\n            case Phase.OptOutConfirm:\n                return _t('Warning!');\n            case Phase.ShowKey:\n            case Phase.KeepItSafe:\n                return _t('Make a copy of your Security Key');\n            case Phase.BackingUp:\n                return _t('Starting backup...');\n            case Phase.Done:\n                return _t('Success!');\n            default:\n                return _t(\"Create key backup\");\n        }\n    }\n\n    public render(): JSX.Element {\n        let content;\n        if (this.state.error) {\n            content = <div>\n                <p>{ _t(\"Unable to create key backup\") }</p>\n                <div className=\"mx_Dialog_buttons\">\n                    <DialogButtons primaryButton={_t('Retry')}\n                        onPrimaryButtonClick={this.createBackup}\n                        hasCancel={true}\n                        onCancel={this.onCancel}\n                    />\n                </div>\n            </div>;\n        } else {\n            switch (this.state.phase) {\n                case Phase.Passphrase:\n                    content = this.renderPhasePassPhrase();\n                    break;\n                case Phase.PassphraseConfirm:\n                    content = this.renderPhasePassPhraseConfirm();\n                    break;\n                case Phase.ShowKey:\n                    content = this.renderPhaseShowKey();\n                    break;\n                case Phase.KeepItSafe:\n                    content = this.renderPhaseKeepItSafe();\n                    break;\n                case Phase.BackingUp:\n                    content = this.renderBusyPhase();\n                    break;\n                case Phase.Done:\n                    content = this.renderPhaseDone();\n                    break;\n                case Phase.OptOutConfirm:\n                    content = this.renderPhaseOptOutConfirm();\n                    break;\n            }\n        }\n\n        return (\n            <BaseDialog className='mx_CreateKeyBackupDialog'\n                onFinished={this.props.onFinished}\n                title={this.titleForPhase(this.state.phase)}\n                hasCancel={[Phase.Passphrase, Phase.Done].includes(this.state.phase)}\n            >\n                <div>\n                    { content }\n                </div>\n            </BaseDialog>\n        );\n    }\n}\n"],"sourceRoot":""}